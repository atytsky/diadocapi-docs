Получение документов
====================

.. contents:: :local:

Работать с документами можно только внутри :doc:`сообщения <../entities/message>`.

Получение сообщения
-------------------

Чтобы получить информацию о текущем состоянии сообщения и о документах, составляющих цепочку документооборота, используйте метод :doc:`../http/GetMessage`. Он возвращает структуру :doc:`../proto/Message`.

Структура :doc:`../proto/Message` может содержать документы, сформированные в разное время разными организациями: например, в одну структуру могут попасть исходящий документ одной организации и подпись к нему, поставленная представителем другой организации.

Чтобы получить содержимое конкретного документа из сообщения, используйте метод :doc:`../http/GetEntityContent`. В него нужно передать идентификаторы ящика, сообщения и :doc:`сущности <../entities/entity>`, т.е. значения полей ``boxId`` и ``messageId`` структуры :doc:`../proto/Message` и поля ``entityId`` структуры :doc:`Entity <../proto/Entity message>`.

Получение документов
--------------------

Получить документы можно с помощью следующих методов:

	- :doc:`../http/GetDocuments` — позволяет получить список документов, удовлетворяющих заданным фильтрам. Например, можно запросить список всех входящих счетов-фактур от указанного контрагента за определенный период. Метод позволяет отфильтровать документы по типу, классу, статусу, контрагенту, подразделению, времени или дате отправки или получения. В теле ответа метод ``GetDocuments`` вернет список документов в виде структуры ``DocumentList`` с вложенной структурой ``Document``.

	- :doc:`../http/GetDocument` — позволяет получить всю информацию о документе по его идентификатору.

Метод ``GetDocuments`` не возвращает содержимое документов — только информацию о них. Чтобы получить содержимое документов, используйте методы :doc:`../http/GetDocument` или :doc:`../http/GetMessage`. В методы нужно передать идентификаторы ``MessageId`` и ``EntityId`` из структуры ``Document``, которую возвращает метод ``GetDocuments``.

Парсинг документа
-----------------

Метод парсинга позволяет получить из полученного XML-файла документа упрощенный XML ``UserDataXml``. Парсинг документа можно использовать, например, чтобы получить данные из предыдущих титулов для генерации титулов последующих участников или чтобы загрузить данные из него в свою учетную систему. Распарсить документ можно с помощью метода :doc:`../http/ParseTitleXml`.

Для парсинга нужны тип, функция, версия и идентификатор титула. Их можно узнать из ответов методов:

- :doc:`../http/GetNewEvents`,
- :doc:`../http/GetMessage`,
- :doc:`../http/GetDocument`,
- :doc:`../http/GetDocflowEvents_V3`,
- :doc:`../http/GetDocflows_V3`.

Также информацию можно получить по XML-файлу титула с помощью метода :doc:`../http/DetectDocumentTitles`: для этого в теле запроса метода передайте бинарное содержимое документа.