{% extends "!page.html" %}

{% block footer %}
 <script type="text/javascript">
 	  document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.toggle').forEach(item => {
        const switcher = document.createElement('div');

        switcher.classList.add('switcher');
        switcher.addEventListener('click', () => {
          item.classList.toggle('open');
        });

        item.appendChild(switcher);
      });

      /* 
        Ограничиваем высоту таблицы у которой есть горизонтальная прокрутка (быстрее видим горизонтальный скролл) 
        setTimeout нужен для поиска таблиц на странице и накидывания стилей (одного DOMContentLoaded оказалось недостаточно...)
      */
      setTimeout(() => {
          document.querySelectorAll('.wy-table-responsive').forEach(table => {
          
          const isOverflowX = ({ clientWidth, scrollWidth }) => scrollWidth > clientWidth;

          if (isOverflowX(table)) {
            table.classList.add('overflow-x-table-styles');
          }
        }) 
      }, 100);

      addFeedbackBanner();
    });

    // Создание баннера обратной связи
    function addFeedbackBanner() {
      if (window.localStorage.getItem("feedbackBanner") === "hidden") {
        return;
      }

      // поправить после того как Аня скажет как будет формирование ссылки идти
      const getFormLink = () => {
        return "https://forms.kontur.ru/form/59f74360-79cd-4309-93c1-f98cea15b7b5";
      }

      // обработчик закрытия баннера обратной связи
      // @param feedbackBannerContainer HTMLDivElement контейнер баннера обратной связи
      const onCloseFeedbackBanner = (feedbackBannerContainer) => {
        feedbackBannerContainer.className = "hiddenFeedbackBannerContainer"
        window.localStorage.setItem("feedbackBanner", "hidden");
      }

      const feedbackBannerContainer = document.createElement("div");
      const feedbackBannerCloseButton = document.createElement("button");
      const feedbackLink = document.createElement("a");
      const feedbackDescriptionTextNode = document.createTextNode("Оставьте обратную связь");
      const feedbackCloseTextNode = document.createTextNode("Закрыть");

      feedbackLink.className = "feedbackLink";
      feedbackLink.href = getFormLink();
      feedbackLink.appendChild(feedbackDescriptionTextNode);
      feedbackLink.onclick = () => onCloseFeedbackBanner(feedbackBannerContainer);

      feedbackBannerCloseButton.className = "feedbackBannerCloseButton";
      feedbackBannerCloseButton.onclick = () => onCloseFeedbackBanner(feedbackBannerContainer);
      feedbackBannerCloseButton.appendChild(feedbackCloseTextNode);

      feedbackBannerContainer.appendChild(feedbackLink);
      feedbackBannerContainer.appendChild(feedbackBannerCloseButton);

      feedbackBannerContainer.className = "feedbackBannerContainer"

      document.body.appendChild(feedbackBannerContainer);
    }
</script>
{% endblock %}