GenerateRevocationRequestXml
============================

Метод ``GenerateRevocationRequestXml`` генерирует предложение об аннулировании.

Версии метода:
	- :ref:`GenerateRevocationRequestXml_v2` — поддерживает несколько версий предложения об аннулировании.
	- :ref:`GenerateRevocationRequestXml_v1` — устаревшая версия.


.. _GenerateRevocationRequestXml_v2:

v2
--

.. http:post:: /V2/GenerateRevocationRequestXml

	:queryparam boxId: идентификатор :doc:`ящика <../entities/box>` организации.
	:queryparam messageId: идентификатор сообщения.
	:queryparam attachmentId: идентификатор сущности документа, для которого нужно сгенерировать предложение об аннулировании.
	:queryparam contentTypeId: версия предложения об аннулировании, которое нужно сгенерировать. Принимает значения:
	
		- ``revocation_request_01`` — для предложения об аннулировании версии 1.01,
		- ``revocation_request_02`` — для предложения об аннулировании версии 1.02.

	:requestheader Authorization: данные, необходимые для :doc:`авторизации <../Authorization>`.

	:request Body: Тело запроса должно содержать данные для генерации предложения об аннулирования документа, представленные структурой :doc:`../proto/RevocationRequestInfo`.

	:statuscode 200: операция успешно завершена.
	:statuscode 400: данные в запросе имеют неверный формат или отсутствуют обязательные параметры.
	:statuscode 401: в запросе отсутствует HTTP-заголовок ``Authorization`` или в этом заголовке содержатся некорректные авторизационные данные.
	:statuscode 402: у организации с указанным идентификатором ``boxId`` закончилась подписка на API.
	:statuscode 403: доступ к ящику с предоставленным авторизационным токеном запрещен.
	:statuscode 404: в указанном ящике нет сообщения с идентификатором ``messageId``, или в указанном сообщении нет сущности с идентификатором ``attachmentId``, или указанная сущность имеет неверный тип, или у указанной сущности нет дочерней сущности типа ``Signature``.
	:statuscode 405: используется неподходящий HTTP-метод.
	:statuscode 409: невозможно сгенерировать предложение об аннулировании.
	:statuscode 500: при обработке запроса возникла непредвиденная ошибка.
	
	:responseheader Content-Disposition: имя файла с предложением об аннулировании.

	:response Body: Тело ответа содержит XML-файл с предложением об аннулировании документа ``attachmentId`` из сообщения ``messageId`` в ящике ``boxId``. Файл с предложением генерируется в соответствии с :download:`XML-схемой <../xsd/DP_PRANNUL_1_985_00_01_01_02.xsd>`.

Для выполнения метода текущий пользователь должен иметь доступ к исходному документу, иначе метод вернет ошибку ``403 (Forbidden)``.

Поведение метода зависит от того, кому отправляется предложение об аннулировании (ПОА):
 
.. image:: ../_static/img/generaterevocationrequestxml_contenttypeid.png
	:align: center

В случае с роуминговым оператором используйте метод :doc:`GetRoamingOperators`, чтобы узнать, поддерживает ли он аннулирование и какой версии.

.. _GenerateRevocationRequestXml_v1:

v1
--

.. http:post:: /GenerateRevocationRequestXml

	:queryparam boxId: идентификатор :doc:`ящика <../entities/box>` организации.
	:queryparam messageId: идентификатор сообщения.
	:queryparam attachmentId: идентификатор сущности документа, для которого нужно сгенерировать предложение об аннулировании.

	:requestheader Authorization: данные, необходимые для :doc:`авторизации <../Authorization>`.

	:request Body: Тело запроса должно содержать данные для генерации предложения об аннулирования документа, представленные структурой :doc:`../proto/RevocationRequestInfo`.

	:statuscode 200: операция успешно завершена.
	:statuscode 400: данные в запросе имеют неверный формат или отсутствуют обязательные параметры.
	:statuscode 401: в запросе отсутствует HTTP-заголовок ``Authorization`` или в этом заголовке содержатся некорректные авторизационные данные.
	:statuscode 403: доступ к ящику с предоставленным авторизационным токеном запрещен.
	:statuscode 404: в указанном ящике нет сообщения с идентификатором ``messageId``, или в указанном сообщении нет сущности с идентификатором ``attachmentId``, или указанная сущность имеет неверный тип, или у указанной сущности нет дочерней сущности типа ``Signature``.
	:statuscode 405: используется неподходящий HTTP-метод.
	:statuscode 409: невозможно сгенерировать предложение об аннулировании.
	:statuscode 500: при обработке запроса возникла непредвиденная ошибка.
	
	:responseheader Content-Disposition: имя файла с предложением об аннулировании.

	:response Body: Тело ответа содержит XML-файл с предложением об аннулировании документа ``attachmentId`` из сообщения ``messageId`` в ящике ``boxId``. Файл с предложением генерируется в соответствии с :download:`XML-схемой <../xsd/DP_PRANNUL_1_985_00_01_01_01.xsd>`.

Для выполнения метода текущий пользователь должен иметь доступ к исходному документу, иначе метод вернет ошибку ``403 (Forbidden)``.