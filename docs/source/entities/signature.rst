Подпись
=======

**Электронная подпись** — прикрепленный к электронному документу файл, который позволяет определить лицо, подписывающее документ. Является аналогом рукописной подписи в цифровом формате. Электронная подпись формируется закрытым ключом, соответствующим сертификату, и средствами криптографической защиты информации (СКЗИ).

Подписи могут быть следующих форматов:

	- Открепленная (отсоединенная) подпись создается отдельно от подписываемого документа. Файл подписи может иметь расширение .sig,.sgn,.p7s. Диадок работает с открепленной подписью.
	- Прикрепленная (присоединенная) подпись является частью подписанного документа. К файлу документа добавляется расширение .sig.
	- Встроенная подпись также является частью документа, но при этом формат исходного документа не меняется. Информацию о подписи можно просмотреть, открыв документ

Работа с подписью в Диадоке
---------------------------

С помощью API Диадока нельзя создать подпись для документа. Подпись нужно сгенерировать самостоятельно и передать файл в методы отправки документа.

Под документом подписи могут быть:

	- подписями отправителя — для отправки документов, сохраненных без отправки,
	- подписями получателя — для двусторонних документов с запросом подписи,
	- согласующими подписями,
	- ответными подписями под запросом на аннулирование документа.

Согласующая подпись
~~~~~~~~~~~~~~~~~~~

Документ можно подписать несколькими квалифицированными электронными подписями. Такие подписи называются согласующими.

Согласующие подписи можно ставить как со стороны отправителя, так и со стороны получателя. Они будут проверены и доставлены контрагенту. Можно отправить не больше 500 согласующих подписей под документом в день .

Согласующую подпись можно поставить:

	- для неформализованного документа — до или после отправки. Если поставить согласующую подпись до отправки, то в ящик получателя она доставится только после отправки — вместе с документом и подписью отправителя.
	- для формализованного документа — только после отправки, потому что при отправке формализованного документа меняется его содержимое.

Передать документ на подписание согласующей подписью можно в поле ``ResolutionRequest`` тела запроса метода :doc:`../http/PostMessagePatch`. Отличить полученную согласующую подпись от обычной можно по флагу ``IsApprovementSignature`` в структуре :doc:`../proto/Entity`.

Чтобы получить возможность использовать согласующую подпись, обратитесь к вашему менеджеру или в техническую поддержку.

Представление в API
-------------------
*Структуры для работы с подписями:*
 - :doc:`../proto/SignatureV3` — содержит информацию о подписи под документом.
 - :doc:`../proto/SignatureInfo` — содержит информацию о подписи и сертификате.
 - :doc:`../proto/DocumentSignature` —  предназначена для представления ЭП к некоторым данным в отправляемом сообщении.
 - :doc:`../proto/DocumentSenderSignature` — предназначена для представления ЭП к документам отправляемого черновика.

*Методы для работы с подписями:*
 - :doc:`../http/GetSignatureInfo` — возвращает информацию о подписи и сертификате в сообщении.

